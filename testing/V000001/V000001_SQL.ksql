CREATE OR REPLACE TABLE ORDERS_CACHE (ORDER_ID_KEY VARCHAR PRIMARY KEY, 
ORDERTIME BIGINT, ORDERID INTEGER, ITEMID VARCHAR, ORDERUNITS DOUBLE, ADDRESS STRUCT<CITY VARCHAR, STATE VARCHAR, ZIPCODE INTEGER>) 
WITH (KAFKA_TOPIC='order_flow', VALUE_FORMAT='JSON');

CREATE OR REPLACE TABLE ORDERS_CACHE_CLEAN WITH (KAFKA_TOPIC='ORDERS_CACHE_CLEAN', VALUE_FORMAT='JSON') AS 
SELECT
  ORDERS_CACHE.ORDER_ID_KEY AS `ORDERID`,
  FROM_UNIXTIME(ORDERS_CACHE.ORDERTIME) AS `ORDERTIME`,
  ORDERS_CACHE.ITEMID AS `ITEMID`,
  ORDERS_CACHE.ORDERUNITS AS `ORDERUNITS`,
  ORDERS_CACHE.ADDRESS->CITY AS `ADDRESS_CITY`,
  ORDERS_CACHE.ADDRESS->STATE AS `ADDRESS_STATE`,
  ORDERS_CACHE.ADDRESS->ZIPCODE AS `ADDRESS_ZIPCODE`
FROM ORDERS_CACHE ORDERS_CACHE
EMIT CHANGES;